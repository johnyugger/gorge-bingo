<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gorge Bingo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --background-light: #E4E0E1;
      --background-medium: #D6C0B3;
      --accent-warm: #AB886D;
      --text-dark: #493628;
      --text-light: #E4E0E1;
      --cell-bg: #F5F1F2;
      --cell-border: #C8B2A6;
      --free-cell: #7D6B5E;
      --win-line: rgba(53, 40, 11, 0.352);
      --shadow: rgba(73, 54, 40, 0.15);
      --hover-dark: #7f5f48;
      --glow-light: rgba(171, 136, 109, 0.3);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #E4E0E1 0%, #EDE8E9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    .container {
      background: linear-gradient(145deg, #D6C0B3, #C8B2A6);
      padding: 25px;
      border-radius: 40px;
      box-shadow: 
        0 15px 44px var(--shadow),
        0 5px 15px rgba(73, 54, 40, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
      width: 1125px;
      max-width: 95vw;
      border: 2px solid rgba(255, 255, 255, 0.4);
    }

    h1 {
    text-align: center;
      margin-bottom: 10px;
      font-size: 55px;
      color: var(--text-dark);
      text-shadow: 2px 2px 4px rgba(73, 54, 40, 0.1);
      letter-spacing: 1px;
      margin-top: 10px;
      background: linear-gradient(45deg, #4d372a, #493628);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .board-wrapper {
      position: relative;
      width: 875px;
      height: 875px;
      margin: 0 auto;
      max-width: 85vw;
      max-height: 85vw;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(228, 224, 225, 0.4);
      border-radius: 30px;
      padding: 20px;
      box-shadow: 
        inset 0 4px 8px rgba(73, 54, 40, 0.1),
        inset 0 -2px 4px rgba(255, 255, 255, 0.6);
    }

    .board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(5, 1fr);
      gap: 12.5px;
      width: 750px;
      height: 750px;
      box-sizing: border-box;
      position: relative;
    }

    .cell {
      border: 2px solid var(--cell-border);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: var(--cell-bg);
      color: var(--text-dark);
      cursor: pointer;
      user-select: none;
      text-align: center;
      box-sizing: border-box;
      overflow: hidden;
      font-weight: 600;
      line-height: 1.2;
      word-break: keep-all;
      overflow-wrap: break-word;
      hyphens: auto;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-size: 20px;
      box-shadow: 
        0 4px 8px rgba(73, 54, 40, 0.08),
        inset 0 2px 4px rgba(255, 255, 255, 0.9);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    /* Unmarked cell hover */
    .cell:not(.marked):not(.free):hover {
      transform: scale(1.04) translateY(-3px);
      background: var(--hover-dark);
      color: var(--cell-bg);
      border-color: var(--hover-dark);
      box-shadow: 
        0 8px 16px rgba(73, 54, 40, 0.2),
        inset 0 2px 4px rgba(0, 0, 0, 0.1);
      z-index: 2;
    }

    /* Marked cell hover */
    .cell.marked:not(.free):hover {
      transform: scale(1.04) translateY(-3px);
      background: var(--text-light);
      color: var(--accent-warm);
      border-color: var(--text-light);
      box-shadow: 
        0 8px 16px rgba(73, 54, 40, 0.2),
        inset 0 2px 4px rgba(0, 0, 0, 0.1);
      z-index: 2;
    }

    /* Free cell - no hover effects */
    .cell.free {
      background: linear-gradient(145deg, var(--free-cell), #6B5548);
      font-weight: 700;
      cursor: default;
      color: var(--text-light);
      border-color: #6B5548;
      transform: none !important;
      box-shadow: 
        0 4px 8px rgba(73, 54, 40, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.2);
    }

    .cell.free::after {
      content: 'â˜…';
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 16px;
      color: #FFD700;
      text-shadow: 0 0 3px rgba(73, 54, 40, 0.5);
    }

    /* Regular cell states (non-hover) */
    .cell.marked {
      background: linear-gradient(145deg, var(--accent-warm), #B99A84);
      color: var(--text-light);
      border-color: #8A6F5D;
      transform: scale(0.98);
      box-shadow: 
        0 3px 6px rgba(73, 54, 40, 0.2),
        inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .cell:active:not(.free) {
      transform: scale(0.96) !important;
      transition: transform 0.1s ease;
    }

    /* Smooth transition back from hover */
    .cell {
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .win-line {
      position: absolute;
      background: var(--win-line);
      border-radius: 9999px;
      pointer-events: none;
      transform-origin: center center;
      z-index: 10;
      box-shadow: 
        0 0 15px rgba(228, 224, 225, 0.8),
        0 0 10px var(--glow-light);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.9; }
      50% { opacity: 1; }
    }

    #status {
      margin-top: 20px;
      text-align: center;
      font-size: 42.5px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 30px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .bingo-count {
      background: linear-gradient(145deg, var(--accent-warm), #8A6F5D);
      color: var(--text-light);
      padding: 10px 25px;
      border-radius: 50px;
      font-size: 24px;
      box-shadow: 0 4px 8px rgba(73, 54, 40, 0.2);
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .win-message {
      animation: celebrate 0.5s ease-out;
      color: var(--accent-warm);
      text-shadow: 2px 2px 4px rgba(73, 54, 40, 0.2);
    }

    @keyframes celebrate {
      0% { transform: scale(0.8); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .cell-animation {
      animation: cellPop 0.3s ease-out;
    }

    @keyframes cellPop {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    @media (max-width: 1200px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 44px;
      }
      
      #status {
        font-size: 34px;
        flex-direction: column;
        gap: 10px;
      }
      
      .bingo-count {
        font-size: 20px;
        padding: 8px 20px;
      }
    }

    @media (max-width: 768px) {
      .cell {
        font-size: 16px;
        padding: 8px;
      }
      
      h1 {
        font-size: 36px;
      }
      
      #status {
        font-size: 28px;
      }
      
      /* Slightly smaller hover scale on mobile */
      .cell:not(.marked):not(.free):hover,
      .cell.marked:not(.free):hover {
        transform: scale(1.02) translateY(-2px);
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Gorge Bingo</h1>

    <div class="board-wrapper" id="wrapper">
      <div id="board" class="board"></div>
      <div id="lines-container"></div>
    </div>

    <div id="status">
      <span id="bingo-message"></span>
      <span id="bingo-count" class="bingo-count" style="display: none;">0 Bingos</span>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // CSV fetching function with better debugging
    async function fetchWordsFromCSV() {
      try {
        console.log('Attempting to fetch list.csv...');
        const response = await fetch('list.csv');
        
        if (!response.ok) {
          console.error(`Failed to fetch list.csv: ${response.status} ${response.statusText}`);
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const csvText = await response.text();
        console.log('CSV content received:', csvText.substring(0, 200) + '...');
        
        // Parse CSV - more robust parsing
        const lines = csvText.split(/[\r\n]+/).map(line => line.trim()).filter(line => line.length > 0);
        console.log('Parsed lines:', lines.length, 'lines found');
        
        if (lines.length === 0) {
          throw new Error('CSV file is empty');
        }
        
        // Debug: log first few lines
        console.log('First 5 lines:', lines.slice(0, 5));
        
        // Handle CSV with or without headers - more lenient check
        const firstLine = lines[0].toLowerCase();
        const hasHeader = firstLine.includes('word') || 
                         firstLine.includes('phrase') || 
                         firstLine.includes('text') ||
                         firstLine.includes('bingo') ||
                         firstLine.includes('item') ||
                         lines[0].includes(',');
        
        if (hasHeader) {
          console.log('Detected header, skipping first line:', lines[0]);
          return lines.slice(1);
        }
        
        console.log('No header detected, using all lines');
        return lines;
      } catch (error) {
        console.error('Error loading CSV:', error);
        console.log('Falling back to default list');
        
        // Fallback to a default set of words if CSV can't be loaded
        return [
          "@apex","india mentioned","Japanese study session","why are there 10 in call during working hours",
          "Cody posts a friendslop","Todd talks about patients","Todd derogatory zzz remarks","morning wagies",
          "i love my wife","Ying talks about some Chinese shit tech","Ying refunds an amazon purchase","George post",
          "George complains about work","George wants to die","George complains seattle","wyd",
          "Cheng talks about patients","it's 1 am and Cheng just got home from work","Cheng posts lunch","Cheng posts steak",
          "Kae says he is working late","Kae posts halal","Eric rallies for csgo",
          "Bob initiates ethnoguessr and carson gets called a racist","Edison on REPO",
          "Edison in call alone for 2+ hours","Someone shits on Zhen","Someone calls Carson racist"
        ];
      }
    }

    // Rest of the code remains the same...
    const board = document.getElementById('board');
    const status = document.getElementById('status');
    const bingoMessage = document.getElementById('bingo-message');
    const bingoCount = document.getElementById('bingo-count');
    const linesContainer = document.getElementById('lines-container');
    const wrapper = document.getElementById('wrapper');
    const STORAGE_KEY = 'daily-bingo-progress';
    const GRID_SIZE = 750;
    const CELL_COUNT = 5;
    const GAP = 12.5;

    let activeWins = new Set();
    let bingoCounter = 0;
    let WORDS = []; // Will be populated from CSV

    function getDailySeed() {
      const d = new Date();
      return d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate();
    }

    function mulberry32(a) {
      return function () {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }

    function shuffle(arr, seed) {
      const a = [...arr];
      const r = mulberry32(seed);
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(r() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function load() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return Array(25).fill(false);
      const d = JSON.parse(raw);
      if (d.date !== getDailySeed()) return Array(25).fill(false);
      return d.marked;
    }

    function save(marked) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ 
        date: getDailySeed(), 
        marked 
      }));
    }

    const WINS = [
      { cells:[0,1,2,3,4], type:'row', i:0, id: 'r0' },
      { cells:[5,6,7,8,9], type:'row', i:1, id: 'r1' },
      { cells:[10,11,12,13,14], type:'row', i:2, id: 'r2' },
      { cells:[15,16,17,18,19], type:'row', i:3, id: 'r3' },
      { cells:[20,21,22,23,24], type:'row', i:4, id: 'r4' },
      { cells:[0,5,10,15,20], type:'col', i:0, id: 'c0' },
      { cells:[1,6,11,16,21], type:'col', i:1, id: 'c1' },
      { cells:[2,7,12,17,22], type:'col', i:2, id: 'c2' },
      { cells:[3,8,13,18,23], type:'col', i:3, id: 'c3' },
      { cells:[4,9,14,19,24], type:'col', i:4, id: 'c4' },
      { cells:[0,6,12,18,24], type:'diag', i:0, id: 'd1' },
      { cells:[4,8,12,16,20], type:'diag', i:1, id: 'd2' }
    ];

    function drawLine(win) {
      const wrapperWidth = wrapper.clientWidth;
      const wrapperHeight = wrapper.clientHeight;
      const gridLeft = (wrapperWidth - GRID_SIZE) / 2;
      const gridTop = (wrapperHeight - GRID_SIZE) / 2;
      
      const cellSize = (GRID_SIZE - GAP * 4) / CELL_COUNT;
      
      const line = document.createElement('div');
      line.className = 'win-line';
      line.dataset.winId = win.id;
      
      if (win.type === 'row') {
        line.style.width = GRID_SIZE + 'px';
        line.style.height = '12.5px';
        line.style.left = gridLeft + 'px';
        line.style.top = (gridTop + win.i * (cellSize + GAP) + cellSize / 2 - 6.25) + 'px';
      }

      if (win.type === 'col') {
        line.style.height = GRID_SIZE + 'px';
        line.style.width = '12.5px';
        line.style.top = gridTop + 'px';
        line.style.left = (gridLeft + win.i * (cellSize + GAP) + cellSize / 2 - 6.25) + 'px';
      }

      if (win.type === 'diag') {
        const diagLength = Math.sqrt(GRID_SIZE * GRID_SIZE + GRID_SIZE * GRID_SIZE);
        line.style.width = diagLength + 'px';
        line.style.height = '12.5px';
        line.style.top = (wrapperHeight / 2 - 6.25) + 'px';
        line.style.left = ((wrapperWidth - diagLength) / 2) + 'px';
        line.style.transformOrigin = 'center center';
        line.style.transform = win.i === 0 ? 'rotate(45deg)' : 'rotate(-45deg)';
      }

      linesContainer.appendChild(line);
      return line;
    }

    function checkAllWins() {
      const cells = [...board.children];
      let newBingos = 0;
      
      WINS.forEach(win => {
        const isComplete = win.cells.every(i => 
          cells[i].classList.contains('marked') || cells[i].classList.contains('free')
        );
        
        const lineExists = document.querySelector(`.win-line[data-win-id="${win.id}"]`);
        
        if (isComplete && !activeWins.has(win.id)) {
          activeWins.add(win.id);
          drawLine(win);
          newBingos++;
        } else if (!isComplete && activeWins.has(win.id)) {
          activeWins.delete(win.id);
          const line = document.querySelector(`.win-line[data-win-id="${win.id}"]`);
          if (line) line.remove();
        }
      });
      
      return newBingos;
    }

    function updateStatus() {
      const totalBingos = activeWins.size;
      
      if (totalBingos === 0) {
        bingoMessage.textContent = '';
        bingoCount.style.display = 'none';
      } else {
        bingoMessage.textContent = 'ðŸŽ‰ BINGO! ðŸŽ‰';
        bingoMessage.classList.add('win-message');
        bingoCount.textContent = `${totalBingos} Bingo${totalBingos > 1 ? 's' : ''}`;
        bingoCount.style.display = 'inline-block';
        
        setTimeout(() => {
          bingoMessage.classList.remove('win-message');
        }, 500);
      }
    }

    async function build() {
      // Show loading message
      bingoMessage.textContent = 'Loading bingo cards...';
      
      // Fetch words from CSV
      WORDS = await fetchWordsFromCSV();
      console.log(`Loaded ${WORDS.length} words from CSV`);
      
      // Check if we have enough words
      if (WORDS.length < 25) {
        console.error(`Only ${WORDS.length} words loaded from CSV, need at least 25`);
        bingoMessage.textContent = `Error: Need 25+ words in list.csv (found ${WORDS.length})`;
        bingoMessage.style.color = 'red';
        return;
      }
      
      // Clear loading message
      bingoMessage.textContent = '';
      bingoMessage.style.color = '';
      
      board.innerHTML = '';
      linesContainer.innerHTML = '';
      activeWins.clear();
      bingoCounter = 0;
      
      bingoMessage.textContent = '';
      bingoCount.style.display = 'none';

      const words = shuffle(WORDS, getDailySeed()).slice(0, 25);
      const saved = load();
      
      console.log('Shuffled words for today:', words);

      words.forEach((w, i) => {
        const c = document.createElement('div');
        c.className = 'cell';
        c.textContent = w;

        if (i === 12) {
          c.textContent = 'Zhen is in call with shawty';
          c.classList.add('free', 'marked');
          saved[i] = true;
        } else {
          if (saved[i]) c.classList.add('marked');
        }

        c.addEventListener('click', () => {
          if (c.classList.contains('free')) return;
          
          // Animation
          c.classList.add('cell-animation');
          setTimeout(() => {
            c.classList.remove('cell-animation');
          }, 300);
          
          // Toggle mark
          c.classList.toggle('marked');
          const marks = [...board.children].map(x => x.classList.contains('marked'));
          save(marks);
          
          // Check for new wins
          const newBingos = checkAllWins();
          if (newBingos > 0) {
            bingoCounter += newBingos;
            updateStatus();
          }
        });

        board.appendChild(c);
      });

      save(saved);
      // Check initial state for wins
      checkAllWins();
      updateStatus();
    }

    // Start building the bingo board
    console.log('Starting bingo build process...');
    build();
  });
</script>
</body>
</html>